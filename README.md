# scala-openliberty-mandelbrot
Example Scala application to implement MicroProfile microservices
An example application to calculate a [Mandelbrot Set](https://en.wikipedia.org/wiki/Mandelbrot_set) using Microprofile/OpenLiberty implementation of microservices. 
The goal is demonstrate implementation and Kubernetes deployment. The solution is not intended to be optimal in terms of choice of technologies or performance. 
Some places are left unoptimised in terms of performance for the benefit of clarity of presentation.

## Application Architecture

The application is divided logically into two microservices, which share the same codebase for the purpose of ease of the implementation.
* *Calculation Service* - implemented by *IterationService* class, this service executes the actual formula iteration calculation for each data point received
  Service parameters:
    * *posx*, *posy* - coordinates of datapoint within image space  
    * *datax*, *datay* - coordinates of the datapoint within data space
    * *iterations* - maximum number of iterations each datapoint should be iterated through 
* *Image Generation Service* - implemented by *ImageService* class, this service maps image space onto data space as specified by query parameters, 
  and then for each datapoint, invokes *Calculation Service* to run the iteration formula. Service parameters:
    * *tlx*, *tly* - coordinates of 'top-left' corner of the data space
    * *brx*, *bry* - coordinates of 'bottom-right' corner of the data space
    * *sx*, *sy* - dimensions of the image to be generated
    * *iterations* - maximum number of iterations each datapoint should be iterated through 

#### OpenLiberty configuration

* */config* directory - The contents of this directory are result of reverse-engineering of contents of the resulting Docker image 
  as created by an example project [GitHub: OpenLiberty/guide-getting-started](https://github.com/OpenLiberty/guide-getting-started)
  * */config/apps* - placeholder directory where the resulting WAR file will be placed in Docker image
  * */config/dropins* - placeholder directory
  * */config/workarea* - placeholder directory
  * */config/bootstrap.properties* - property file with values used by *server.xml* file
  * */config/server.env* - file generated by the above GitHub project
  * */config/server.xml* - main OpenLiberty server configuration file
* */opt/ol/wlp/output/defaultServer/resources/security/* - the below two files were copied from a running container (using *docker cp*) 
  and placed in the respective target folder to reduce server startup files. 
  These files, if not provided already, were generated anew each time a container was started up.
  * *key.p12*
  * *ltpa.keys*
  
#### Kubernetes configuration

* */src/main/k8s* - contains YAML files to create Kubernetes deployments and services 

![Image](img/image-640-480.png)

## [Preparing Docker image](README-Docker.md)
## [Deploying Docker image on Kubernetes](README-k8s.md)
## Links
* [OpenLiberty](https://openliberty.io/)
* [Microprofile Specification](https://microprofile.io/)
* [sbt-docker](https://github.com/marcuslonnberg/sbt-docker)]
* [xsbt-web-plugin](https://github.com/earldouglas/xsbt-web-plugin)
* [GitHub: OpenLiberty/guide-getting-started](https://github.com/OpenLiberty/guide-getting-started)
* [Docker Toolbox](https://docs.docker.com/toolbox/overview/)
* [Kubernetes cheatsheet](https://kubernetes.io/docs/reference/kubectl/cheatsheet/)

## Infrastructure
* Amazon Web Services (AWS)
    * 3 nodes : *t2.small* , OS: Debian Stretch 9.11
* Docker version 19.03.2
* Kubernetes version v1.15.0